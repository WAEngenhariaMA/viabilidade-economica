<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>WA Engenharia ‚Äì Analisador de Viabilidade Econ√¥mica</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: 50px auto;
      background-color: rgba(0, 0, 0, 0.9);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    }
    h1 {
      text-align: center;
      color: #00bcd4;
      margin-bottom: 10px;
    }
    h2 {
      text-align: left;
      color: #00bcd4;
      margin-top: 5px;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .col-100 {
      flex: 1 1 100%;
    }
    .col-50 {
      flex: 1 1 48%;
    }
    .col-33 {
      flex: 1 1 30%;
    }
    input[type="text"], input[type="email"], input[type="tel"], select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      box-sizing: border-box;
    }
    .buttons {
      margin-top: 20px;
      text-align: right;
    }
    button {
      padding: 10px 20px;
      background-color: #00bcd4;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 10px;
    }
    button:hover {
      background-color: #0193a3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WA Engenharia ‚Äì Analisador de Viabilidade Econ√¥mica</h1>
    <form id="viabilidadeForm">
      <div class="step active" id="step1">
         <h2>Dados Gerais do Projeto</h2>
        <div class="form-group col-100">          
          <label for="nome">Nome do Projeto/Empresa:</label>
          <input type="text" id="nome" name="nome" required>
        </div>

        <div class="row">
          <div class="form-group col-33">
            <label for="tipo">Tipo de Atividade:</label>
            <select id="tipo" name="tipo" required>
              <option value="">Selecione...</option>
              <option value="Constru√ß√£o Civil">Constru√ß√£o Civil</option>
              <option value="Servi√ßos T√©cnicos Profissionais">Servi√ßos T√©cnicos Profissionais</option>
              <option value="Com√©rcio e Varejo">Com√©rcio e Varejo</option>
              <option value="Ind√∫stria e Produ√ß√£o">Ind√∫stria e Produ√ß√£o</option>
              <option value="Est√©tica, Sa√∫de e Bem-Estar">Est√©tica, Sa√∫de e Bem-Estar</option>
              <option value="Eventos, Campeonatos e Produ√ß√µes">Eventos, Campeonatos e Produ√ß√µes</option>
              <option value="Neg√≥cios Digitais e Tecnologia">Neg√≥cios Digitais e Tecnologia</option>
              <option value="Alimenta√ß√£o, Bares e Delivery">Alimenta√ß√£o, Bares e Delivery</option>
              <option value="Franquias e Modelos Licenciados">Franquias e Modelos Licenciados</option>
            </select>
          </div>

          <div class="form-group col-33">
            <label for="local">Cidade/Estado:</label>
            <input type="text" id="local" name="local" required>
          </div>

          <div class="form-group col-33">
            <label for="estrutura">Estrutura:</label>
            <select id="estrutura" name="estrutura" required>
              <option value="">Selecione...</option>
              <option value="F√≠sica">F√≠sica</option>
              <option value="Virtual">Virtual</option>
              <option value="H√≠brida">H√≠brida</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="form-group col-50">
            <label for="regime">Regime Tribut√°rio:</label>
            <select id="regime" name="regime">
              <option value="">N√£o se aplica / N√£o definido</option>
              <option value="MEI">MEI</option>
              <option value="Simples Nacional">Simples Nacional</option>
              <option value="Lucro Presumido">Lucro Presumido</option>
              <option value="Lucro Real">Lucro Real</option>
            </select>
          </div>

          <div class="form-group col-50">
            <label for="situacao">Situa√ß√£o Atual:</label>
            <select id="situacao" name="situacao" required>
              <option value="">Selecione...</option>
              <option value="Planejamento">Planejamento</option>
              <option value="Em opera√ß√£o">Em opera√ß√£o</option>
              <option value="Em expans√£o">Em expans√£o</option>
            </select>
          </div>
        </div>

        <div class="form-group col-100">
          <label for="responsavel">Respons√°vel:</label>
          <input type="text" id="responsavel" name="responsavel" required>
        </div>

        <div class="form-group col-100">
          <label for="email">E-mail:</label>
          <input type="email" id="email" name="email" required>
        </div>

        <div class="form-group col-50">
         <label for="telefone">Telefone:</label>
        <input type="tel" id="telefone" name="telefone" required>
      </div>
      </div>
   <div class="step" id="step2">
  <h2>Custos e Investimentos (Com√©rcio e Varejo)</h2>

  <!-- Cadastro de Produtos -->
  <div class="form-group col-100">
    <label>1.1. Produto ‚Äì Descri√ß√£o do Produto</label>
    <div id="listaProdutos"></div>
    <button type="button" onclick="adicionarProduto()">‚ûï Cadastrar Novo Produto</button>
  </div>

  <!-- Container de produtos adicionados -->
<template id="produtoTemplate">
  <div class="produto-box" style="border: 1px solid #00bcd4; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
    <div class="form-group col-100">
      <label>Nome do Produto:</label>
      <input type="text" class="nomeProduto" required>
    </div>

    <div class="row">
      <div class="form-group col-50">
        <label>1.2. Custo de Produ√ß√£o Direto:</label>
        <div style="display: flex; gap: 10px;">
          <select class="tipoCusto" onchange="alternarCusto(this)" style="flex: 1;">
            <option value="monetario">Valor Monet√°rio</option>
            <option value="percentual">Percentual (%)</option>
          </select>
          <input type="text" class="valorCusto currency" placeholder="R$ ou %" style="flex: 1;">
        </div>
      </div>

      <div class="form-group col-50">
        <label>1.3. Pre√ßo de Venda Pretendido (R$):</label>
        <input type="text" class="precoVenda currency">
        <button type="button" onclick="mostrarCalculo(this)">üßÆ Calcular Pre√ßo de Venda</button>
      </div>
    </div>

    <div class="form-group col-100 boxCalculo" style="display:none; margin-top:10px; border-top:1px solid #ccc; padding-top:10px;">
      <label>C√°lculo do Pre√ßo de Venda</label>
      <input type="text" class="custoBase currency" placeholder="Custo Base (R$)">
      <input type="text" class="margemLucro currency" placeholder="Margem de Lucro (%)">
      <input type="text" class="precoConcorrencia currency" placeholder="Pre√ßo da Concorr√™ncia (R$)">
      <button type="button" onclick="calcularPreco(this)">üìå Usar no campo 1.3</button>
      <button type="button" onclick="this.closest('.boxCalculo').style.display='none'" style="background-color: #757575; color: white; margin-top: 5px;">‚ùå Fechar C√°lculo</button>
    </div>

    <div style="margin-top: 10px; display: flex; gap: 10px;">
      <button type="button" onclick="salvarProduto(this)" style="background-color:#4caf50;">üíæ Salvar Produto</button>
      <button type="button" onclick="removerProduto(this)" style="background-color:#e53935;">üóë Excluir Produto</button>
    </div>
  </div>
</template>

  <!-- Investimento Inicial -->
  <h3 style="color:#00bcd4;">2. Investimento Inicial</h3>
  <div class="form-group col-50"><label>2.1. Cria√ß√£o de Marca e Registro (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.2. Abertura de Empresa e Licen√ßas (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.3. Consultorias (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.4. Estoque Inicial (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.5. Equipamentos (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.6. Imobilizados (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.7. Capital de Giro (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>2.8. Outros (R$):</label><input type="text" class="currency"></div>

  <!-- Custos Vari√°veis -->
  <h3 style="color:#00bcd4;">3. Custos Vari√°veis</h3>
  <div class="form-group col-100"><label>3.1. Custos com Produ√ß√£o (valor ou %):</label><input type="text" class="currency" id="campoCustoProducaoTotal"></div>
  <div class="form-group col-50"><label>3.2. Impostos (%):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>3.3. Comiss√£o de Vendas (%):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>3.4. Tarifas de Cart√£o (%):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>3.5. Outros (%):</label><input type="text" class="currency"></div>

  <!-- Custos Fixos Mensais -->
  <h3 style="color:#00bcd4;">4. Custos Mensais Fixos</h3>
  <h4>4.1. Despesas Administrativas</h4>
  <div class="form-group col-50"><label>Aluguel (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Energia (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Sal√°rios (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Internet (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Outros (R$):</label><input type="text" class="currency"></div>

  <h4>4.2. Despesas Comerciais</h4>
  <div class="form-group col-50"><label>Combust√≠vel (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Sal√°rios Equipe Comercial (R$):</label><input type="text" class="currency"></div>

  <h4>4.3. Despesas Operacionais</h4>
  <div class="form-group col-50"><label>Despesa 1 (R$):</label><input type="text" class="currency"></div>
  <div class="form-group col-50"><label>Despesa 2 (R$):</label><input type="text" class="currency"></div>

  <!-- Plano Comercial -->
  <h3 style="color:#00bcd4;">5. Plano Comercial</h3>
  <div class="form-group col-100"><label>5.1. P√∫blico Alvo:</label><textarea rows="5"></textarea></div>
  <div class="form-group col-100"><label>5.2. Diferenciais do Produto:</label><textarea rows="5"></textarea></div>
  <div class="form-group col-100"><label>5.3. Poss√≠veis Concorrentes:</label><textarea rows="5"></textarea></div>
  <div class="form-group col-100"><label>5.4. Volume de Vendas Esperado (por Produto):</label><div id="volumeProdutos"></div></div>
  <div class="form-group col-100"><label>5.5. Taxa de Crescimento Mensal (%):</label><input type="text" class="currency"></div>
</div>
<script>
function adicionarProduto() {
  const container = document.getElementById("listaProdutos");
  const idx = document.querySelectorAll(".produto-bloco").length;
  const bloco = document.createElement("div");
  bloco.className = "produto-bloco";
  bloco.innerHTML = `
    <hr>
    <label>Nome do Produto:</label>
    <input type="text" id="produto_nome_${idx}" class="col-100">

    <label>1.2. Custo de Produ√ß√£o Direto:</label>
    <select id="tipo_custo_${idx}" onchange="alternarCusto(${idx})">
      <option value="valor">Valor Monet√°rio</option>
      <option value="percentual">Percentual</option>
    </select>
    <input type="text" id="custo_produto_${idx}" class="currency" placeholder="R$ ou %">

    <label>1.3. Pre√ßo de Venda Pretendido (R$):</label>
    <input type="text" id="preco_venda_${idx}" class="currency">
    <button type="button" onclick="calcularPrecoVenda(${idx})">üßÆ Calcular Pre√ßo de Venda</button>

    <div id="box_calculo_${idx}" style="display:none; margin-top:10px;">
      <label>Custo (R$):</label><input type="text" id="custo_base_${idx}" class="currency">
      <label>Margem de Lucro (%):</label><input type="text" id="margem_${idx}" class="currency">
      <label>Pre√ßo da Concorr√™ncia (R$):</label><input type="text" id="concorrencia_${idx}" class="currency">
      <button type="button" onclick="aplicarPrecoCalculado(${idx})">Aplicar Pre√ßo Calculado</button>
    </div>
  `;
  container.appendChild(bloco);
}

function alternarCusto(idx) {
  const tipo = document.getElementById(`tipo_custo_${idx}`).value;
  const input = document.getElementById(`custo_produto_${idx}`);
  input.placeholder = tipo === "percentual" ? "%" : "R$";
}

function calcularPreco(btn) {
  const bloco = btn.closest('.produto-box');
  const custo = parseFloat(bloco.querySelector('.custoBase').value.replace(/\./g, '').replace(',', '.')) || 0;
  const margem = parseFloat(bloco.querySelector('.margemLucro').value.replace(',', '.')) || 0;
  const concorrente = parseFloat(bloco.querySelector('.precoConcorrencia').value.replace(/\./g, '').replace(',', '.')) || 0;

  const preco = custo + (custo * margem / 100);
  const precoFinal = concorrente > 0 ? (preco + concorrente) / 2 : preco;

  bloco.querySelector('.precoVenda').value = precoFinal.toFixed(2).replace('.', ',');

  // Fecha o c√°lculo
  bloco.querySelector('.boxCalculo').style.display = 'none';
}

  function mostrarCalculo(btn) {
  const bloco = btn.closest('.produto-box');
  bloco.querySelector('.boxCalculo').style.display = 'block';
}
function salvarProduto(btn) {
  const bloco = btn.closest('.produto-box');
  const nome = bloco.querySelector('.nomeProduto').value;
  const custo = bloco.querySelector('.valorCusto').value;
  const preco = bloco.querySelector('.precoVenda').value;
  alert(`‚úÖ Produto "${nome}" salvo!\nCusto: ${custo} | Pre√ßo: ${preco}`);
}
  
function aplicarPrecoCalculado(idx) {
  const custo = parseFloat(document.getElementById(`custo_base_${idx}`).value.replace(/\./g, '').replace(',', '.')) || 0;
  const margem = parseFloat(document.getElementById(`margem_${idx}`).value.replace(',', '.')) || 0;
  const concorrente = parseFloat(document.getElementById(`concorrencia_${idx}`).value.replace(/\./g, '').replace(',', '.')) || 0;
  const preco = custo + (custo * margem / 100);
  const precoFinal = concorrente > 0 ? (preco + concorrente) / 2 : preco;
  document.getElementById(`preco_venda_${idx}`).value = precoFinal.toFixed(2).replace('.', ',');
}
  function salvarProduto(btn) {
  const bloco = btn.closest('.produto-box');
  const nome = bloco.querySelector('.nomeProduto').value;
  const custo = bloco.querySelector('.valorCusto').value;
  const preco = bloco.querySelector('.precoVenda').value;
  alert(`‚úÖ Produto "${nome}" salvo!\nCusto: ${custo} | Pre√ßo: ${preco}`);
}
</script>


<div class="step" id="step3">
  <h2>Receita, Lucro e Ponto de Equil√≠brio</h2>

  <h3 style="color:#00bcd4;">Receita Esperada</h3>
        <label for="preco_unitario">Pre√ßo M√©dio por Unidade (R$):</label>
        <input type="text" id="preco_unitario" class="currency">

        <label for="quantidade_mensal">Unidades Vendidas por M√™s (Estimativa):</label>
        <input type="number" id="quantidade_mensal">

        <label for="receita_mensal">Receita Bruta Mensal (R$):</label>
        <input type="text" id="receita_mensal" readonly>

        <label for="receita_anual">Receita Anual Estimada (R$):</label>
        <input type="text" id="receita_anual" readonly>

       <h3 style="color:#00bcd4;">Receita por Cen√°rios</h3>

<div class="row-group">
  <div>
    <label for="qtd_pessimista">Unidades - Pessimista:</label>
    <input type="number" id="qtd_pessimista" min="0">
  </div>
  <div>
    <label for="receita_pessimista">Receita Pessimista (R$):</label>
    <input type="text" id="receita_pessimista" readonly>
  </div>
</div>

<div class="row-group">
  <div>
    <label for="qtd_realista">Unidades - Realista:</label>
    <input type="number" id="qtd_realista" min="0">
  </div>
  <div>
    <label for="receita_realista">Receita Realista (R$):</label>
    <input type="text" id="receita_realista" readonly>
  </div>
</div>

<div class="row-group">
  <div>
    <label for="qtd_otimista">Unidades - Otimista:</label>
    <input type="number" id="qtd_otimista" min="0">
  </div>
  <div>
    <label for="receita_otimista">Receita Otimista (R$):</label>
    <input type="text" id="receita_otimista" readonly>
  </div>
</div>

        <h3 style="color:#00bcd4;">Proje√ß√£o de Lucro</h3>
        <label for="custos_fixos_total">Total de Custos Fixos Mensais (R$):</label>
        <input type="text" id="custos_fixos_total" readonly>

        <label for="custos_variaveis_total">Total de Custos Vari√°veis Mensais (R$):</label>
        <input type="text" id="custos_variaveis_total" readonly>

        <label for="lucro_operacional">Lucro Operacional Mensal (R$):</label>
        <input type="text" id="lucro_operacional" readonly>

        <label for="margem_lucro">Margem de Lucro (%):</label>
        <input type="text" id="margem_lucro" readonly>

        <h3 style="color:#00bcd4;">Ponto de Equil√≠brio</h3>
        <label for="custo_unitario_variavel">Custo Vari√°vel por Unidade (R$):</label>
        <input type="text" id="custo_unitario_variavel" class="currency">

        <label for="ponto_equilibrio">Ponto de Equil√≠brio (em Unidades):</label>
        <input type="text" id="ponto_equilibrio" readonly>
      </div>
    
  <!-- Etapa 4: Indicadores Econ√¥micos -->
<div class="step" id="step4">
  <h2>Indicadores Econ√¥micos</h2>

  <label for="taxa_desconto">Taxa de Desconto (% a.a):</label>
  <input type="text" id="taxa_desconto" class="currency" value="10,00">
  <small style="font-size: 12px; color: #ccc;">
    Utilizada para trazer o valor do dinheiro ao presente em an√°lises de fluxo de caixa.
  </small>

  <label for="ponto_equilibrio_fin">Ponto de Equil√≠brio Financeiro:</label>
  <input type="text" id="ponto_equilibrio_fin" readonly>
  <small style="font-size: 12px; color: #ccc;">
    Receita m√≠nima necess√°ria para cobrir os custos fixos e vari√°veis.
  </small>

  <label for="payback">Payback (meses):</label>
  <input type="text" id="payback" readonly>
  <small style="font-size: 12px; color: #ccc;">
    Tempo necess√°rio (em meses) para recuperar o valor investido inicialmente.
  </small>

  <label for="roi">ROI (%):</label>
  <input type="text" id="roi" readonly>
  <small style="font-size: 12px; color: #ccc;">
    Retorno sobre o investimento: (Lucro √∑ Investimento Inicial) √ó 100.
  </small>

  <label for="vpl">VPL (R$):</label>
  <input type="text" id="vpl" readonly>
  <small style="font-size: 12px; color: #ccc;">
    Valor Presente L√≠quido dos lucros esperados nos pr√≥ximos anos, descontados pela taxa definida.
  </small>

  <label for="tir">TIR (%):</label>
  <input type="text" id="tir" readonly>
  <small style="font-size: 12px; color: #ccc;">
    Taxa de retorno interna que torna o VPL igual a zero.
  </small>
</div>
 <!-- Etapa 5 -->
  <div class="step" id="step5">
  <h2>An√°lise Final e Observa√ß√µes</h2>
  <table>
    <thead>
      <tr><th>Item</th><th>Status (Sim/N√£o)</th></tr>
    </thead>
    <tbody>
      <tr><td>Receita cobre os custos fixos?</td><td id="check_receita"></td></tr>
      <tr><td>Projeto tem ROI acima de 20%?</td><td id="check_roi"></td></tr>
      <tr><td>Payback abaixo de 12 meses?</td><td id="check_payback"></td></tr>
      <tr><td>Fluxo de caixa positivo nos 6 primeiros meses?</td><td id="check_fluxo"></td></tr>
    </tbody>
  </table>
  <div class="form-group col-100">
    <label for="avaliacao_final">Avalia√ß√£o de Viabilidade Econ√¥mica:</label>
    <select id="avaliacao_final">
      <option value="">Selecione...</option>
      <option>Vi√°vel com Alta Rentabilidade</option>
      <option>Vi√°vel com Ajustes</option>
      <option>Pouco Vi√°vel no Momento</option>
      <option>N√£o Recomendado</option>
    </select>
  </div>

  <div class="form-group col-100" style="margin-top: 20px; text-align: center;">
    <button type="button" onclick="gerarPDFPersonalizado()" style="background-color:#00bcd4; color:#fff; border:none; padding:10px 20px; border-radius:6px; font-size:16px; cursor:pointer;">
      üìÑ Gerar Relat√≥rio em PDF
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
async function carregarImagemBase64(url) {
  const response = await fetch(url);
  const blob = await response.blob();
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.readAsDataURL(blob);
  });
}

async function gerarPDFPersonalizado() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'mm', 'a4');
  const imgBase64 = await carregarImagemBase64('./img/layout_canva.png');

  doc.addImage(imgBase64, 'PNG', 0, 0, 210, 297);

  let y = 30;
  doc.setFontSize(18);
  doc.setTextColor(1, 10, 40);
  doc.setFont('helvetica', 'bold');
  doc.text('Relat√≥rio de Viabilidade Econ√¥mica', 15, y);
  y += 10;

  doc.setFontSize(14);
  doc.setTextColor(0);
  doc.setFont('helvetica', 'bold');
  doc.text(`Projeto: ${document.getElementById('nome').value}`, 15, y);
  y += 8;

  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.text('Dados Gerais:', 15, y);
  y += 6;

  doc.setFont('helvetica', 'normal');
  const dados = [
    ['Tipo de Atividade', 'tipo'],
    ['Cidade/Estado', 'local'],
    ['Estrutura', 'estrutura'],
    ['Regime Tribut√°rio', 'regime'],
    ['Situa√ß√£o Atual', 'situacao'],
    ['Respons√°vel', 'responsavel'],
    ['E-mail', 'email'],
    ['Telefone', 'telefone']
  ];
  dados.forEach(([label, id]) => {
    doc.text(`${label}: ${document.getElementById(id).value}`, 15, y);
    y += 6;
  });

  y += 4;
  doc.setFont('helvetica', 'bold');
  doc.text('Indicadores Financeiros:', 15, y);
  y += 6;
  doc.setFont('helvetica', 'normal');

  const indicadores = [
    ['Receita Mensal', 'receita_mensal'],
    ['Receita Anual', 'receita_anual'],
    ['Lucro Operacional Mensal', 'lucro_operacional'],
    ['Margem de Lucro', 'margem_lucro'],
    ['Ponto de Equil√≠brio', 'ponto_equilibrio'],
    ['Payback', 'payback'],
    ['ROI', 'roi'],
    ['VPL', 'vpl'],
    ['TIR', 'tir']
  ];

  indicadores.forEach(([label, id]) => {
    if (y > 280) {
      doc.addPage();
      y = 10;
    }
    doc.text(`${label}: ${document.getElementById(id).value}`, 15, y);
    y += 6;
  });

  y += 6;
  doc.setFont('helvetica', 'bold');
  doc.text('Checklist de Viabilidade:', 15, y);
  y += 6;
  doc.setFont('helvetica', 'normal');

  const checklist = [
    ['Receita cobre os custos fixos?', 'check_receita'],
    ['Projeto tem ROI acima de 20%?', 'check_roi'],
    ['Payback abaixo de 12 meses?', 'check_payback'],
    ['Fluxo de caixa positivo nos 6 primeiros meses?', 'check_fluxo']
  ];
  checklist.forEach(([label, id]) => {
    doc.text(`${label}: ${document.getElementById(id).textContent}`, 15, y);
    y += 6;
  });

  y += 6;
  doc.setFont('helvetica', 'bold');
  doc.text(`Avalia√ß√£o Final: ${document.getElementById('avaliacao_final').value}`, 15, y);

  doc.save('Relatorio_Viabilidade_Economica.pdf');
}
</script>
<script>
function atualizarChecklistAnalise() {
  const receita = parseFloat(document.getElementById('receita_mensal').value.replace(/\./g, '').replace(',', '.')) || 0;
  const fixos = parseFloat(document.getElementById('custos_fixos_total').value.replace(/\./g, '').replace(',', '.')) || 0;
  const roi = parseFloat(document.getElementById('roi').value.replace('%','').replace(',', '.')) || 0;
  const payback = parseFloat(document.getElementById('payback').value.replace(',', '.')) || 0;
  const lucro = receita - fixos;

  const check_receita = receita >= fixos;
  const check_roi = roi > 20;
  const check_payback = payback > 0 && payback <= 12;
  const check_fluxo = lucro > 0;

  document.getElementById('check_receita').textContent = check_receita ? 'Sim' : 'N√£o';
  document.getElementById('check_roi').textContent = check_roi ? 'Sim' : 'N√£o';
  document.getElementById('check_payback').textContent = check_payback ? 'Sim' : 'N√£o';
  document.getElementById('check_fluxo').textContent = check_fluxo ? 'Sim' : 'N√£o';

  const totalSim = [check_receita, check_roi, check_payback, check_fluxo].filter(Boolean).length;
  const avaliacaoFinal = document.getElementById('avaliacao_final');

  if (totalSim === 4) {
    avaliacaoFinal.value = 'Vi√°vel com Alta Rentabilidade';
  } else if (totalSim === 3) {
    avaliacaoFinal.value = 'Vi√°vel com Ajustes';
  } else if (totalSim === 2) {
    avaliacaoFinal.value = 'Pouco Vi√°vel no Momento';
  } else {
    avaliacaoFinal.value = 'N√£o Recomendado';
  }
}

document.addEventListener("input", atualizarChecklistAnalise);
</script>
 
<script>
  document.addEventListener("input", function () {
    function moedaParaNumero(str) {
      return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
    }
    function numeroParaMoeda(num) {
      return num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    const preco = moedaParaNumero(document.getElementById('preco_unitario').value);
    const qtd = parseInt(document.getElementById('quantidade_mensal').value) || 0;
    const receitaMensal = preco * qtd;
    const receitaAnual = receitaMensal * 12;

    document.getElementById('receita_mensal').value = numeroParaMoeda(receitaMensal);
    document.getElementById('receita_anual').value = numeroParaMoeda(receitaAnual);

    // Receita por Cen√°rios
    const pess = parseInt(document.getElementById('qtd_pessimista').value) || 0;
    const real = parseInt(document.getElementById('qtd_realista').value) || 0;
    const otim = parseInt(document.getElementById('qtd_otimista').value) || 0;

    document.getElementById('receita_pessimista').value = numeroParaMoeda(pess * preco);
    document.getElementById('receita_realista').value = numeroParaMoeda(real * preco);
    document.getElementById('receita_otimista').value = numeroParaMoeda(otim * preco);


    const fixos = moedaParaNumero(document.getElementById('custos_fixos_total').value);
    const variaveis = moedaParaNumero(document.getElementById('custos_variaveis_total').value);
    const lucro = receitaMensal - (fixos + variaveis);
    const margem = receitaMensal ? (lucro / receitaMensal) * 100 : 0;

    document.getElementById('lucro_operacional').value = numeroParaMoeda(lucro);
    document.getElementById('margem_lucro').value = margem.toFixed(1).replace('.', ',') + '%';

    const custoVariavelUnitario = moedaParaNumero(document.getElementById('custo_unitario_variavel').value);
    const pontoEquilibrio = preco > custoVariavelUnitario ? (fixos / (preco - custoVariavelUnitario)) : 0;

    document.getElementById('ponto_equilibrio').value = Math.ceil(pontoEquilibrio);
  }); 
</script>
  <div class="buttons" id="navigationButtons"></div>
  </form> <!-- Fechamento correto do formul√°rio -->
</div> 
  <script>
    function renderButtons(currentStep) {
      const container = document.getElementById('navigationButtons');
      container.innerHTML = '';

      const limpar = document.createElement('button');
      limpar.textContent = 'Limpar';
      limpar.type = 'button';
      limpar.onclick = limparCamposEtapa;
      container.appendChild(limpar);

      if (currentStep > 0) {
        const voltar = document.createElement('button');
        voltar.textContent = 'Voltar';
        voltar.type = 'button';
        voltar.onclick = prevStep;
        container.appendChild(voltar);
      }

      if (currentStep < document.querySelectorAll('.step').length - 1) {
        const proximo = document.createElement('button');
        proximo.textContent = 'Pr√≥ximo';
        proximo.type = 'button';
        proximo.onclick = nextStep;
        container.appendChild(proximo);
      }
    }

    function nextStep() {
      const steps = document.querySelectorAll(".step");
      for (let i = 0; i < steps.length; i++) {
        if (steps[i].classList.contains("active")) {
          const requiredInputs = steps[i].querySelectorAll("input[required], select[required]");
          for (let j = 0; j < requiredInputs.length; j++) {
            if (!requiredInputs[j].value) {
              alert("Por favor, preencha todos os campos obrigat√≥rios antes de continuar.");
              return;
            }
          }
          steps[i].classList.remove("active");
          if (i + 1 < steps.length) {
            steps[i + 1].classList.add("active");
            renderButtons(i + 1);
          }
          break;
        }
      }
    }

    function prevStep() {
      const steps = document.querySelectorAll(".step");
      for (let i = 0; i < steps.length; i++) {
        if (steps[i].classList.contains("active")) {
          steps[i].classList.remove("active");
          if (i - 1 >= 0) {
            steps[i - 1].classList.add("active");
            renderButtons(i - 1);
          }
          break;
        }
      }
    }

    function limparCamposEtapa() {
      const etapaAtual = document.querySelector('.step.active');
      const inputs = etapaAtual.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], input[type="tel"], textarea, select');

      inputs.forEach(input => {
        if (input.tagName.toLowerCase() === 'select') {
          input.selectedIndex = 0;
        } else {
          input.value = '';
        }
      });
    }

    window.onload = () => {
      renderButtons(0);
  // Bloqueia letras em campos num√©ricos
  document.querySelectorAll('input[type="number"]').forEach(input => {
    input.addEventListener('input', function () {
      this.value = this.value.replace(/[^0-9]/g, '');
    });
  });
};

     document.getElementById('tipo').addEventListener('change', function () {
      const tipo = this.value;
      document.getElementById('atividadeSelecionada').innerText = tipo;
const camposDiv = document.getElementById('camposEspecificos');
  camposDiv.innerHTML = '';
      const campos = {
        'Constru√ß√£o Civil': {
          'Custos Fixos': ['Sal√°rios e Encargos', 'Gest√£o Administrativa', 'Internet e Energia', 'Contabilidade e Licenciamento'],
          'Custos Vari√°veis': ['Materiais de Constru√ß√£o', 'Frete e Log√≠stica', 'Desperd√≠cios e Sobras', 'Taxas por m¬≤ executado'],
          'Investimento Inicial': ['Ferramentas e Equipamentos', 'EPIs e Sinaliza√ß√£o', 'Projetos T√©cnicos e ART', 'Infraestrutura de Canteiro']
        },
        'Servi√ßos T√©cnicos Profissionais': {
          'Custos Fixos': ['Aluguel do Escrit√≥rio', 'Internet e Softwares', 'Contabilidade', 'Equipe de Apoio'],
          'Custos Vari√°veis': ['Deslocamentos', 'Materiais de Apresenta√ß√£o', 'Comiss√µes', 'Taxas de Documenta√ß√£o'],
          'Investimento Inicial': ['Notebook e Equipamentos', 'Identidade Visual e Branding', 'Site/Portf√≥lio Profissional', 'Reformas no Escrit√≥rio']
        },
        'Com√©rcio e Varejo': {
          'Custos Fixos': ['Aluguel e Condom√≠nio', 'Equipe de Atendimento', 'Sistema PDV e Internet', 'Contabilidade'],
          'Custos Vari√°veis': ['Estoque de Produtos', 'Frete de Fornecedores', 'Comiss√µes sobre vendas', 'Sacos, etiquetas, embalagens'],
          'Investimento Inicial': ['Estrutura da Loja', 'Vitrine, M√≥veis, Balc√£o', 'Marketing de Lan√ßamento', 'Softwares de Gest√£o']
        },
        'Ind√∫stria e Produ√ß√£o': {
          'Custos Fixos': ['Energia El√©trica', 'Equipe de Produ√ß√£o', 'Manuten√ß√£o Preventiva', 'Supervis√£o e Qualidade'],
          'Custos Vari√°veis': ['Mat√©ria-prima', 'Perdas Operacionais', 'Log√≠stica de Distribui√ß√£o', 'Subcontrata√ß√µes'],
          'Investimento Inicial': ['M√°quinas e Equipamentos', 'Layout de Produ√ß√£o', 'Controle de Qualidade', 'Licenciamento Industrial']
        },
        'Est√©tica, Sa√∫de e Bem-Estar': {
          'Custos Fixos': ['Aluguel da Cl√≠nica', 'Recepcionista / Secret√°ria', 'Internet e Software M√©dico', 'Contabilidade e Vigil√¢ncia Sanit√°ria'],
          'Custos Vari√°veis': ['Insumos Descart√°veis', 'Luvas, m√°scaras, uniformes', 'Reposi√ß√£o de Produtos', 'Comiss√µes Profissionais'],
          'Investimento Inicial': ['Aparelhos Est√©ticos', 'Consult√≥rio e Mobili√°rio', 'Reformas e Decorativo', 'Publicidade Inicial']
        },
        'Eventos, Campeonatos e Produ√ß√µes': {
          'Custos Fixos': ['Equipe Organizadora', 'Internet e Suporte', 'Coordena√ß√£o T√©cnica', 'Deslocamentos'],
          'Custos Vari√°veis': ['Estrutura de Palco/Tendas', 'Alimenta√ß√£o e Log√≠stica', 'Contrata√ß√£o de Servi√ßos', 'Seguran√ßa e Limpeza'],
          'Investimento Inicial': ['Premia√ß√µes', 'Identidade Visual e M√≠dia', 'Site/App do Evento', 'Kit Atleta/Participante']
        },
        'Neg√≥cios Digitais e Tecnologia': {
          'Custos Fixos': ['Plataformas e Ferramentas', 'Equipe T√©cnica/Atendimento', 'Dom√≠nio e Hospedagem', 'Gest√£o e Monitoramento'],
          'Custos Vari√°veis': ['Tr√°fego Pago (Meta, Google)', 'Comiss√µes de Afiliados', 'Suporte e SaaS Vari√°veis', 'Impostos por Faturamento'],
          'Investimento Inicial': ['Desenvolvimento de App/Site', 'Branding e Posicionamento', 'Capta√ß√£o de Leads', 'Produ√ß√£o de Conte√∫do']
        },
        'Alimenta√ß√£o, Bares e Delivery': {
          'Custos Fixos': ['Aluguel do Estabelecimento', 'Equipe de Cozinha e Gar√ßons', '√Ågua, G√°s, Energia', 'Licen√ßas e Taxas Municipais'],
          'Custos Vari√°veis': ['Ingredientes e Bebidas', 'Perdas e Validades', 'Embalagens e Delivery', 'Comiss√µes de Apps'],
          'Investimento Inicial': ['Cozinha Industrial', 'Balc√µes, Mesas, Freezers', 'Sistema de Pedido e Entrega', 'Marketing de Abertura']
        },
        'Franquias e Modelos Licenciados': {
          'Custos Fixos': ['Royalties Mensais', 'Equipe Local', 'Despesas de Loja/Unidade', 'Sistema do Franqueador'],
          'Custos Vari√°veis': ['Materiais e Produtos', 'Marketing Local', 'Reposi√ß√£o de Estoque', 'Taxas Operacionais'],
          'Investimento Inicial': ['Taxa de Franquia', 'Padroniza√ß√£o da Unidade', 'Treinamento Inicial', 'Implementa√ß√£o T√©cnica']
        }
      };

      if (campos[tipo]) {
    for (const categoria in campos[tipo]) {
      camposDiv.innerHTML += `<h3 style="color:#00bcd4;">${categoria}</h3>`;
      campos[tipo][categoria].forEach(label => {
        const id = label.toLowerCase().normalize("NFD").replace(/[^\w\s]/gi, '').replace(/\s+/g, '_');
        camposDiv.innerHTML += `
          <div class="form-group col-50">
            <label for="${id}">${label} (R$):</label>
            <input type="text" id="${id}" class="currency">
          </div>
        `;
      });
    }
  }
});

    document.addEventListener("input", function(e) {
      if (e.target.classList.contains("currency")) {
        let value = e.target.value.replace(/\D/g, "");
        value = (parseInt(value, 10) / 100).toFixed(2);
        e.target.value = value.replace(".", ",").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
      }

      // Etapa 3 c√°lculo autom√°tico
      const moedaParaNumero = str => parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
      const numeroParaMoeda = num => num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");

      const preco = moedaParaNumero(document.getElementById('preco_unitario').value);
      const qtd = parseInt(document.getElementById('quantidade_mensal').value) || 0;
      const receitaMensal = preco * qtd;
      document.getElementById('receita_mensal').value = numeroParaMoeda(receitaMensal);
      document.getElementById('receita_anual').value = numeroParaMoeda(receitaMensal * 12);

      let fixos = 0, variaveis = 0;
      document.querySelectorAll('#camposEspecificos h3').forEach(h3 => {
  const categoria = h3.textContent.trim().toLowerCase();
  let soma = 0;

  let elementoAtual = h3.nextElementSibling;
  while (elementoAtual && elementoAtual.tagName !== 'H3') {
    const input = elementoAtual.querySelector('input');
    if (input) soma += moedaParaNumero(input.value);
    elementoAtual = elementoAtual.nextElementSibling;
  }

  if (categoria.includes('fixos')) fixos += soma;
  if (categoria.includes('vari√°veis')) variaveis += soma;
});


      document.getElementById('custos_fixos_total').value = numeroParaMoeda(fixos);
      document.getElementById('custos_variaveis_total').value = numeroParaMoeda(variaveis);

      const lucro = receitaMensal - (fixos + variaveis);
      document.getElementById('lucro_operacional').value = numeroParaMoeda(lucro);
      document.getElementById('margem_lucro').value = receitaMensal ? ((lucro / receitaMensal) * 100).toFixed(1).replace('.', ',') + '%' : '0%';

      const custoVariavelUnitario = moedaParaNumero(document.getElementById('custo_unitario_variavel').value);
      const pontoEquilibrio = preco > custoVariavelUnitario ? (fixos / (preco - custoVariavelUnitario)) : 0;
      document.getElementById('ponto_equilibrio').value = Math.ceil(pontoEquilibrio);
    });
     function moedaParaNumero(str) {
      return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
    }

    function numeroParaMoeda(num) {
      return num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function calcularEtapa4() {
  const moedaParaNumero = str => parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
  const numeroParaMoeda = num => num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");

  const receita = moedaParaNumero(document.getElementById('receita_mensal').value);
  const fixos = moedaParaNumero(document.getElementById('custos_fixos_total').value);
  const variaveis = moedaParaNumero(document.getElementById('custos_variaveis_total').value);
  const lucro = receita - (fixos + variaveis);
  const taxa = moedaParaNumero(document.getElementById('taxa_desconto').value) / 100;

  // üßÆ Investimento Inicial (buscando todos os campos ap√≥s h3 "Investimento Inicial")
let investimento = 0;
document.querySelectorAll('#camposEspecificos h3').forEach(h3 => {
  const categoria = h3.textContent.trim().toLowerCase();
  if (categoria.includes('investimento')) {
    let el = h3.nextElementSibling;
    while (el && el.tagName !== 'H3') {
      const input = el.querySelector('input');
      if (input) investimento += moedaParaNumero(input.value);
      el = el.nextElementSibling;
    }
  }
});

  // üß† C√°lculos principais
  const margem = receita ? (variaveis / receita) : 0;
  const pontoEq = receita ? (fixos / (1 - margem)) : 0;
  const payback = lucro > 0 ? (Math.abs(investimento) / lucro) : 0;
  const roi = investimento > 0 ? ((lucro * 12 / Math.abs(investimento)) * 100) : 0;

  // üí∞ VPL e TIR (fluxo de 60 meses)
  let vpl = 0;
  for (let t = 1; t <= 60; t++) {
    vpl += lucro / Math.pow(1 + taxa, t);
  }
  vpl -= investimento;

  let tir = 0, step = 0.0001;
  while (tir < 1) {
    let testVPL = 0;
    for (let t = 1; t <= 60; t++) {
      testVPL += lucro / Math.pow(1 + tir, t);
    }
    if (testVPL < investimento) break;
    tir += step;
  }

  // üì© Preencher os campos da etapa 4
  document.getElementById('ponto_equilibrio_fin').value = numeroParaMoeda(pontoEq);
  document.getElementById('payback').value = payback.toFixed(1).replace('.', ',');
  document.getElementById('roi').value = roi.toFixed(1).replace('.', ',') + '%';
  document.getElementById('vpl').value = numeroParaMoeda(vpl);
  document.getElementById('tir').value = (tir * 100).toFixed(2).replace('.', ',') + '%';
}

    document.addEventListener("input", calcularEtapa4);
  </script>
</body>
</html>
