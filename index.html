<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>WA Engenharia – Analisador de Viabilidade Econômica</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
    }
    .container {
      max-width: 800px;
      margin: 50px auto;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    }
    h1 {
      text-align: center;
      color: #00bcd4;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"], input[type="email"], input[type="tel"], select, input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      margin-top: 5px;
    }
    .buttons {
      margin-top: 20px;
      text-align: right;
    }
    button {
      padding: 10px 20px;
      background-color: #00bcd4;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 10px;
    }
    button:hover {
      background-color: #0193a3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WA Engenharia – Analisador de Viabilidade Econômica</h1>
    <form id="viabilidadeForm">
      <div class="step active" id="step1">
        <h2>1. Dados Gerais do Projeto</h2>
        <label for="nome">Nome do Projeto/Empresa:</label>
        <input type="text" id="nome" name="nome" required>

        <label for="tipo">Tipo de Atividade:</label>
        <select id="tipo" name="tipo" required>
          <option value="">Selecione...</option>
          <option value="Construção Civil">Construção Civil</option>
          <option value="Serviços Técnicos Profissionais">Serviços Técnicos Profissionais</option>
          <option value="Comércio e Varejo">Comércio e Varejo</option>
          <option value="Indústria e Produção">Indústria e Produção</option>
          <option value="Estética, Saúde e Bem-Estar">Estética, Saúde e Bem-Estar</option>
          <option value="Eventos, Campeonatos e Produções">Eventos, Campeonatos e Produções</option>
          <option value="Negócios Digitais e Tecnologia">Negócios Digitais e Tecnologia</option>
          <option value="Alimentação, Bares e Delivery">Alimentação, Bares e Delivery</option>
          <option value="Franquias e Modelos Licenciados">Franquias e Modelos Licenciados</option>
        </select>

        <label for="local">Cidade/Estado:</label>
        <input type="text" id="local" name="local" required>

        <label for="estrutura">Estrutura:</label>
        <select id="estrutura" name="estrutura" required>
          <option value="">Selecione...</option>
          <option value="Física">Física</option>
          <option value="Virtual">Virtual</option>
          <option value="Híbrida">Híbrida</option>
        </select>

        <label for="regime">Regime Tributário:</label>
        <select id="regime" name="regime">
          <option value="">Não se aplica / Não definido</option>
          <option value="MEI">MEI</option>
          <option value="Simples Nacional">Simples Nacional</option>
          <option value="Lucro Presumido">Lucro Presumido</option>
          <option value="Lucro Real">Lucro Real</option>
        </select>

        <label for="situacao">Situação Atual:</label>
        <select id="situacao" name="situacao" required>
          <option value="">Selecione...</option>
          <option value="Planejamento">Planejamento</option>
          <option value="Em operação">Em operação</option>
          <option value="Em expansão">Em expansão</option>
        </select>

        <label for="responsavel">Responsável:</label>
        <input type="text" id="responsavel" name="responsavel" required>

        <label for="email">E-mail:</label>
        <input type="email" id="email" name="email" required>

        <label for="telefone">Telefone:</label>
        <input type="tel" id="telefone" name="telefone" required>
      </div>
      
      <div class="step" id="step2">
   <h2>2. Custos e Investimentos</h2>
<p><strong>Atividade selecionada:</strong> <span id="atividadeSelecionada">-</span></p>
<div id="camposEspecificos"></div>
      </div>
<div class="step" id="step3">
  <h2>3. Receita, Lucro e Ponto de Equilíbrio</h2>

  <h3 style="color:#00bcd4;">Receita Esperada</h3>
        <label for="preco_unitario">Preço Médio por Unidade (R$):</label>
        <input type="text" id="preco_unitario" class="currency">

        <label for="quantidade_mensal">Unidades Vendidas por Mês (Estimativa):</label>
        <input type="number" id="quantidade_mensal">

        <label for="receita_mensal">Receita Bruta Mensal (R$):</label>
        <input type="text" id="receita_mensal" readonly>

        <label for="receita_anual">Receita Anual Estimada (R$):</label>
        <input type="text" id="receita_anual" readonly>

        <h3 style="color:#00bcd4;">Receita por Cenários</h3>
        <label for="qtd_pessimista">Unidades Vendidas - Cenário Pessimista:</label>
        <input type="number" id="qtd_pessimista">
        <label for="receita_pessimista">Receita Pessimista (R$):</label>
        <input type="text" id="receita_pessimista" readonly>

        <label for="qtd_realista">Unidades Vendidas - Cenário Realista:</label>
        <input type="number" id="qtd_realista">
        <label for="receita_realista">Receita Realista (R$):</label>
        <input type="text" id="receita_realista" readonly>

        <label for="qtd_otimista">Unidades Vendidas - Cenário Otimista:</label>
        <input type="number" id="qtd_otimista">
        <label for="receita_otimista">Receita Otimista (R$):</label>
        <input type="text" id="receita_otimista" readonly>

        <h3 style="color:#00bcd4;">Projeção de Lucro</h3>
        <label for="custos_fixos_total">Total de Custos Fixos Mensais (R$):</label>
        <input type="text" id="custos_fixos_total" readonly>

        <label for="custos_variaveis_total">Total de Custos Variáveis Mensais (R$):</label>
        <input type="text" id="custos_variaveis_total" readonly>

        <label for="lucro_operacional">Lucro Operacional Mensal (R$):</label>
        <input type="text" id="lucro_operacional" readonly>

        <label for="margem_lucro">Margem de Lucro (%):</label>
        <input type="text" id="margem_lucro" readonly>

        <h3 style="color:#00bcd4;">Ponto de Equilíbrio</h3>
        <label for="custo_unitario_variavel">Custo Variável por Unidade (R$):</label>
        <input type="text" id="custo_unitario_variavel" class="currency">

        <label for="ponto_equilibrio">Ponto de Equilíbrio (em Unidades):</label>
        <input type="text" id="ponto_equilibrio" readonly>
      </div>
    
  </div>
<!-- Etapa 4 -->
     <div class="step" id="step4">
        <h2>4. Indicadores Econômicos</h2>

        <label for="taxa_desconto">Taxa de Desconto (% a.a):</label>
        <input type="text" id="taxa_desconto" class="currency" value="10,00">

        <label for="ponto_equilibrio_fin">Ponto de Equilíbrio Financeiro:</label>
        <input type="text" id="ponto_equilibrio_fin" readonly>

        <label for="payback">Payback (meses):</label>
        <input type="text" id="payback" readonly>

        <label for="roi">ROI (%):</label>
        <input type="text" id="roi" readonly>

        <label for="vpl">VPL (R$):</label>
        <input type="text" id="vpl" readonly>

        <label for="tir">TIR (%):</label>
        <input type="text" id="tir" readonly>
      </div>
 <!-- Etapa 5 -->
      <div class="step" id="step5">
        <h2>4. Análise Final e Observações</h2>
        <label for="observacoes">Observações Finais, Comentários ou Estratégias:</label>
        <textarea id="observacoes" name="observacoes" rows="6" style="width: 100%; padding: 10px; font-size: 14px; border-radius: 6px; border: none;"></textarea>

        <label for="avaliacao_final">Avaliação de Viabilidade Econômica:</label>
        <select id="avaliacao_final" name="avaliacao_final">
          <option value="">Selecione...</option>
          <option value="Viável com Alta Rentabilidade">Viável com Alta Rentabilidade</option>
          <option value="Viável com Ajustes">Viável com Ajustes</option>
          <option value="Pouco Viável no Momento">Pouco Viável no Momento</option>
          <option value="Não Recomendado">Não Recomendado</option>
        </select>

        <label for="proximos_passos">Próximos Passos Sugeridos:</label>
        <textarea id="proximos_passos" name="proximos_passos" rows="4" style="width: 100%; padding: 10px; font-size: 14px; border-radius: 6px; border: none;"></textarea>
      </div>
  </form>
<script>
  document.addEventListener("input", function () {
    function moedaParaNumero(str) {
      return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
    }
    function numeroParaMoeda(num) {
      return num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    const preco = moedaParaNumero(document.getElementById('preco_unitario').value);
    const qtd = parseInt(document.getElementById('quantidade_mensal').value) || 0;
    const receitaMensal = preco * qtd;
    const receitaAnual = receitaMensal * 12;

    document.getElementById('receita_mensal').value = numeroParaMoeda(receitaMensal);
    document.getElementById('receita_anual').value = numeroParaMoeda(receitaAnual);

    // Receita por Cenários
    const pess = parseInt(document.getElementById('qtd_pessimista').value) || 0;
    const real = parseInt(document.getElementById('qtd_realista').value) || 0;
    const otim = parseInt(document.getElementById('qtd_otimista').value) || 0;

    document.getElementById('receita_pessimista').value = numeroParaMoeda(pess * preco);
    document.getElementById('receita_realista').value = numeroParaMoeda(real * preco);
    document.getElementById('receita_otimista').value = numeroParaMoeda(otim * preco);


    const fixos = moedaParaNumero(document.getElementById('custos_fixos').value);
    const variaveis = moedaParaNumero(document.getElementById('custos_variaveis').value);
    const lucro = receitaMensal - (fixos + variaveis);
    const margem = receitaMensal ? (lucro / receitaMensal) * 100 : 0;

    document.getElementById('lucro_operacional').value = numeroParaMoeda(lucro);
    document.getElementById('margem_lucro').value = margem.toFixed(1).replace('.', ',') + '%';

    const custoVariavelUnitario = moedaParaNumero(document.getElementById('custo_unitario_variavel').value);
    const pontoEquilibrio = preco > custoVariavelUnitario ? (fixos / (preco - custoVariavelUnitario)) : 0;

    document.getElementById('ponto_equilibrio').value = Math.ceil(pontoEquilibrio);
  });
 
</script>


      <div class="buttons">
        <button type="button" onclick="prevStep()">Voltar</button>
        <button type="button" onclick="nextStep()">Próximo</button>
      </div>
    </form>
  </div>

  <script>
    function nextStep() {
  const steps = document.querySelectorAll(".step");
  for (let i = 0; i < steps.length; i++) {
    if (steps[i].classList.contains("active")) {
      // Validação dos campos obrigatórios antes de avançar
      const requiredInputs = steps[i].querySelectorAll("input[required], select[required]");
      for (let j = 0; j < requiredInputs.length; j++) {
        if (!requiredInputs[j].value) {
          alert("Por favor, preencha todos os campos obrigatórios antes de continuar.");
          return;
        }
      }
      steps[i].classList.remove("active");
      if (i + 1 < steps.length) {
        steps[i + 1].classList.add("active");
      }
      break;
    }
  }
}

    function prevStep() {
  const steps = document.querySelectorAll(".step");
  for (let i = 0; i < steps.length; i++) {
    if (steps[i].classList.contains("active")) {
      steps[i].classList.remove("active");
      if (i - 1 >= 0) {
        steps[i - 1].classList.add("active");
      }
      break;
    }
  }
}

     document.getElementById('tipo').addEventListener('change', function () {
      const tipo = this.value;
      document.getElementById('atividadeSelecionada').innerText = tipo;
const camposDiv = document.getElementById('camposEspecificos');
  camposDiv.innerHTML = '';
      const campos = {
        'Construção Civil': {
          'Custos Fixos': ['Salários e Encargos', 'Gestão Administrativa', 'Internet e Energia', 'Contabilidade e Licenciamento'],
          'Custos Variáveis': ['Materiais de Construção', 'Frete e Logística', 'Desperdícios e Sobras', 'Taxas por m² executado'],
          'Investimento Inicial': ['Ferramentas e Equipamentos', 'EPIs e Sinalização', 'Projetos Técnicos e ART', 'Infraestrutura de Canteiro']
        },
        'Serviços Técnicos Profissionais': {
          'Custos Fixos': ['Aluguel do Escritório', 'Internet e Softwares', 'Contabilidade', 'Equipe de Apoio'],
          'Custos Variáveis': ['Deslocamentos', 'Materiais de Apresentação', 'Comissões', 'Taxas de Documentação'],
          'Investimento Inicial': ['Notebook e Equipamentos', 'Identidade Visual e Branding', 'Site/Portfólio Profissional', 'Reformas no Escritório']
        },
        'Comércio e Varejo': {
          'Custos Fixos': ['Aluguel e Condomínio', 'Equipe de Atendimento', 'Sistema PDV e Internet', 'Contabilidade'],
          'Custos Variáveis': ['Estoque de Produtos', 'Frete de Fornecedores', 'Comissões sobre vendas', 'Sacos, etiquetas, embalagens'],
          'Investimento Inicial': ['Estrutura da Loja', 'Vitrine, Móveis, Balcão', 'Marketing de Lançamento', 'Softwares de Gestão']
        },
        'Indústria e Produção': {
          'Custos Fixos': ['Energia Elétrica', 'Equipe de Produção', 'Manutenção Preventiva', 'Supervisão e Qualidade'],
          'Custos Variáveis': ['Matéria-prima', 'Perdas Operacionais', 'Logística de Distribuição', 'Subcontratações'],
          'Investimento Inicial': ['Máquinas e Equipamentos', 'Layout de Produção', 'Controle de Qualidade', 'Licenciamento Industrial']
        },
        'Estética, Saúde e Bem-Estar': {
          'Custos Fixos': ['Aluguel da Clínica', 'Recepcionista / Secretária', 'Internet e Software Médico', 'Contabilidade e Vigilância Sanitária'],
          'Custos Variáveis': ['Insumos Descartáveis', 'Luvas, máscaras, uniformes', 'Reposição de Produtos', 'Comissões Profissionais'],
          'Investimento Inicial': ['Aparelhos Estéticos', 'Consultório e Mobiliário', 'Reformas e Decorativo', 'Publicidade Inicial']
        },
        'Eventos, Campeonatos e Produções': {
          'Custos Fixos': ['Equipe Organizadora', 'Internet e Suporte', 'Coordenação Técnica', 'Deslocamentos'],
          'Custos Variáveis': ['Estrutura de Palco/Tendas', 'Alimentação e Logística', 'Contratação de Serviços', 'Segurança e Limpeza'],
          'Investimento Inicial': ['Premiações', 'Identidade Visual e Mídia', 'Site/App do Evento', 'Kit Atleta/Participante']
        },
        'Negócios Digitais e Tecnologia': {
          'Custos Fixos': ['Plataformas e Ferramentas', 'Equipe Técnica/Atendimento', 'Domínio e Hospedagem', 'Gestão e Monitoramento'],
          'Custos Variáveis': ['Tráfego Pago (Meta, Google)', 'Comissões de Afiliados', 'Suporte e SaaS Variáveis', 'Impostos por Faturamento'],
          'Investimento Inicial': ['Desenvolvimento de App/Site', 'Branding e Posicionamento', 'Captação de Leads', 'Produção de Conteúdo']
        },
        'Alimentação, Bares e Delivery': {
          'Custos Fixos': ['Aluguel do Estabelecimento', 'Equipe de Cozinha e Garçons', 'Água, Gás, Energia', 'Licenças e Taxas Municipais'],
          'Custos Variáveis': ['Ingredientes e Bebidas', 'Perdas e Validades', 'Embalagens e Delivery', 'Comissões de Apps'],
          'Investimento Inicial': ['Cozinha Industrial', 'Balcões, Mesas, Freezers', 'Sistema de Pedido e Entrega', 'Marketing de Abertura']
        },
        'Franquias e Modelos Licenciados': {
          'Custos Fixos': ['Royalties Mensais', 'Equipe Local', 'Despesas de Loja/Unidade', 'Sistema do Franqueador'],
          'Custos Variáveis': ['Materiais e Produtos', 'Marketing Local', 'Reposição de Estoque', 'Taxas Operacionais'],
          'Investimento Inicial': ['Taxa de Franquia', 'Padronização da Unidade', 'Treinamento Inicial', 'Implementação Técnica']
        }
      };

      if (campos[tipo]) {
        for (const categoria in campos[tipo]) {
          camposDiv.innerHTML += `<h4>${categoria}</h4>`;
          campos[tipo][categoria].forEach(label => {
            const id = label.toLowerCase().normalize("NFD").replace(/[^\w\s]/gi, '').replace(/\s+/g, '_');
            camposDiv.innerHTML += `
              <label for="${id}">${label} (R$):</label>
              <input type="text" id="${id}" class="currency">
            `;
          });
        }
      }
    });

    document.addEventListener("input", function(e) {
      if (e.target.classList.contains("currency")) {
        let value = e.target.value.replace(/\D/g, "");
        value = (parseInt(value, 10) / 100).toFixed(2);
        e.target.value = value.replace(".", ",").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
      }

      // Etapa 3 cálculo automático
      const moedaParaNumero = str => parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
      const numeroParaMoeda = num => num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");

      const preco = moedaParaNumero(document.getElementById('preco_unitario').value);
      const qtd = parseInt(document.getElementById('quantidade_mensal').value) || 0;
      const receitaMensal = preco * qtd;
      document.getElementById('receita_mensal').value = numeroParaMoeda(receitaMensal);
      document.getElementById('receita_anual').value = numeroParaMoeda(receitaMensal * 12);

      let fixos = 0, variaveis = 0;
      document.querySelectorAll('#camposEspecificos h4').forEach(h4 => {
        const categoria = h4.innerText.trim();
        let soma = 0;
        let el = h4.nextElementSibling;
        while (el && el.tagName !== 'H4') {
          if (el.tagName === 'INPUT') soma += moedaParaNumero(el.value);
          el = el.nextElementSibling;
        }
        if (categoria.includes('Fixos')) fixos += soma;
        if (categoria.includes('Variáveis')) variaveis += soma;
      });

      document.getElementById('custos_fixos_total').value = numeroParaMoeda(fixos);
      document.getElementById('custos_variaveis_total').value = numeroParaMoeda(variaveis);

      const lucro = receitaMensal - (fixos + variaveis);
      document.getElementById('lucro_operacional').value = numeroParaMoeda(lucro);
      document.getElementById('margem_lucro').value = receitaMensal ? ((lucro / receitaMensal) * 100).toFixed(1).replace('.', ',') + '%' : '0%';

      const custoVariavelUnitario = moedaParaNumero(document.getElementById('custo_unitario_variavel').value);
      const pontoEquilibrio = preco > custoVariavelUnitario ? (fixos / (preco - custoVariavelUnitario)) : 0;
      document.getElementById('ponto_equilibrio').value = Math.ceil(pontoEquilibrio);
    });
    function calcularEtapa4() {
      const receita = moedaParaNumero(document.getElementById('receita_mensal').value);
      const fixos = moedaParaNumero(document.getElementById('custos_fixos_total').value);
      const variaveis = moedaParaNumero(document.getElementById('custos_variaveis_total').value);
      const lucro = receita - (fixos + variaveis);

      const investimento = Array.from(document.querySelectorAll('#camposEspecificos label'))
        .filter(l => l.textContent.includes('Investimento Inicial'))
        .map(l => moedaParaNumero(l.nextElementSibling?.value || '0'))
        .reduce((a,b) => a + b, 0);

      const taxa = moedaParaNumero(document.getElementById('taxa_desconto').value) / 100;
      const margem = receita ? (variaveis / receita) : 0;
      const pontoEq = receita ? (fixos / (1 - margem)) : 0;
      const payback = lucro > 0 ? (investimento / lucro) : 0;
      const roi = investimento > 0 ? ((lucro * 12 / investimento) * 100) : 0;

      let vpl = 0;
      for (let t = 1; t <= 60; t++) {
        vpl += lucro / Math.pow(1 + taxa, t);
      }

      let tir = 0, step = 0.0001;
      while (tir < 1) {
        let testVPL = 0;
        for (let t = 1; t <= 60; t++) testVPL += lucro / Math.pow(1 + tir, t);
        if (testVPL < investimento) break;
        tir += step;
      }

      document.getElementById('ponto_equilibrio_fin').value = numeroParaMoeda(pontoEq);
      document.getElementById('payback').value = payback.toFixed(1).replace('.', ',');
      document.getElementById('roi').value = roi.toFixed(1).replace('.', ',') + '%';
      document.getElementById('vpl').value = numeroParaMoeda(vpl);
      document.getElementById('tir').value = (tir * 100).toFixed(2).replace('.', ',') + '%';
    }

    document.addEventListener("input", calcularEtapa4);
  </script>
</body>
</html>
